<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Professional Slot Raffle - Last Man Standing</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
    
    body {
      margin: 0;
      padding: 0;
      font-family: 'Orbitron', sans-serif;
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
      min-height: 100vh;
    }
    
    .slot-reel {
      overflow: hidden;
      position: relative;
      background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
      border: 3px solid #00ff88;
      box-shadow: 
        inset 0 0 20px rgba(0, 255, 136, 0.3),
        0 0 30px rgba(0, 255, 136, 0.5);
    }
    
    .slot-container {
      position: relative;
      will-change: transform;
    }
    
    .slot-item {
      display: flex;
      align-items: center;
      justify-content: center;
      color: #00ff88;
      font-weight: 700;
      text-shadow: 0 0 10px rgba(0, 255, 136, 0.8);
      font-size: 32px;
      height: 100px;
      border-bottom: 1px solid rgba(0, 255, 136, 0.2);
    }
    
    .winner-card {
      animation: glow 2s ease-in-out infinite;
    }
    
    @keyframes glow {
      0%, 100% { box-shadow: 0 0 20px rgba(0, 255, 136, 0.5), inset 0 0 20px rgba(0, 255, 136, 0.1); }
      50% { box-shadow: 0 0 40px rgba(0, 255, 136, 0.8), inset 0 0 30px rgba(0, 255, 136, 0.2); }
    }
    
    @keyframes pulse-gold {
      0%, 100% { transform: scale(1); box-shadow: 0 0 30px rgba(255, 215, 0, 0.5); }
      50% { transform: scale(1.02); box-shadow: 0 0 60px rgba(255, 215, 0, 0.8); }
    }
    
    @keyframes pulse-silver {
      0%, 100% { transform: scale(1); box-shadow: 0 0 30px rgba(192, 192, 192, 0.5); }
      50% { transform: scale(1.02); box-shadow: 0 0 60px rgba(192, 192, 192, 0.8); }
    }
    
    @keyframes pulse-bronze {
      0%, 100% { transform: scale(1); box-shadow: 0 0 30px rgba(205, 127, 50, 0.5); }
      50% { transform: scale(1.02); box-shadow: 0 0 60px rgba(205, 127, 50, 0.8); }
    }
    
    .prize-gold {
      animation: pulse-gold 1.5s ease-in-out infinite;
    }
    
    .prize-silver {
      animation: pulse-silver 1.5s ease-in-out infinite;
    }
    
    .prize-bronze {
      animation: pulse-bronze 1.5s ease-in-out infinite;
    }
    
    .neon-text {
      text-shadow: 
        0 0 10px #00ff88,
        0 0 20px #00ff88,
        0 0 30px #00ff88,
        0 0 40px #00ff88,
        0 0 70px #00ff88;
      color: #00ff88;
    }
    
    .status-active {
      background: rgba(0, 255, 136, 0.1);
      border-left: 4px solid #00ff88;
    }
    
    .status-out {
      background: rgba(255, 52, 52, 0.1);
      border-left: 4px solid #ff3434;
      opacity: 0.6;
    }
  </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useRef, useEffect } = React;

const App = () => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [userApproved, setUserApproved] = useState(false);

  useEffect(() => {
    const firebaseConfig = {
      apiKey: "AIzaSyA0os6xPPS29j_iqDuYSd9aMW7pOovNuG0",
      authDomain: "randomize-games-shuffling.firebaseapp.com",
      projectId: "randomize-games-shuffling",
      storageBucket: "randomize-games-shuffling.firebasestorage.app",
      messagingSenderId: "527934386467",
      appId: "1:527934386467:web:eef28bc366288ec83e1c96"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    
    const auth = firebase.auth();
    const db = firebase.firestore();

    const unsubscribe = auth.onAuthStateChanged(async (currentUser) => {
      if (currentUser) {
        const userDoc = await db.collection('users').doc(currentUser.uid).get();
        if (userDoc.exists && userDoc.data().approved) {
          setUser(currentUser);
          setUserApproved(true);
        } else {
          await auth.signOut();
          window.location.href = 'login.html';
        }
      } else {
        window.location.href = 'login.html';
      }
      setLoading(false);
    });

    return () => unsubscribe();
  }, []);

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-950 flex items-center justify-center">
        <div className="text-center">
          <p className="text-white text-2xl font-black neon-text mb-4">LOADING...</p>
        </div>
      </div>
    );
  }

  if (!user || !userApproved) {
    return null;
  }

  return <ProfessionalSlotRaffle user={user} />;
};

const ProfessionalSlotRaffle = ({ user }) => {
  const [numbers, setNumbers] = useState({});
  const [participants, setParticipants] = useState([]);
  const [participantStatus, setParticipantStatus] = useState({});
  const [history, setHistory] = useState([]);
  const [isSpinning, setIsSpinning] = useState(false);
  const [winners, setWinners] = useState([]);
  const [showWinners, setShowWinners] = useState(false);
  const [reel1Data, setReel1Data] = useState([]);
  const [reel2Data, setReel2Data] = useState([]);
  const [reel3Data, setReel3Data] = useState([]);
  const [remainingCount, setRemainingCount] = useState(0);
  const [prizes, setPrizes] = useState({ first: '', second: '', third: '' });
  const [gameStarted, setGameStarted] = useState(false);
  const [finalWinners, setFinalWinners] = useState(null);
  const [db, setDb] = useState(null);
  const [gameCompleted, setGameCompleted] = useState(false);
  const [currentGameId, setCurrentGameId] = useState(null);
  const [viewMode, setViewMode] = useState('game');
  const [gameHistory, setGameHistory] = useState([]);
  const [loadingHistory, setLoadingHistory] = useState(false);
  const [sortOrder, setSortOrder] = useState('desc');
  const [selectedGame, setSelectedGame] = useState(null);

  const reel1Ref = useRef(null);
  const reel2Ref = useRef(null);
  const reel3Ref = useRef(null);

  // Initialize Firestore
  useEffect(() => {
    setDb(firebase.firestore());
  }, []);

  // Initialize all 50 numbers
  useEffect(() => {
    const init = {};
    for (let i = 1; i <= 50; i++) {
      init[i] = { names: ['', ''] };
    }
    setNumbers(init);
  }, []);

  // Load game history
  const loadGameHistory = async () => {
    if (!db || !user) return;
    setLoadingHistory(true);
    try {
      const gamesSnapshot = await db.collection('users')
        .doc(user.uid)
        .collection('games')
        .orderBy('createdAt', sortOrder)
        .limit(50)
        .get();
      
      const games = gamesSnapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data(),
        createdAt: doc.data().createdAt?.toDate()
      }));
      setGameHistory(games);
    } catch (error) {
      console.error('Error loading game history:', error);
    }
    setLoadingHistory(false);
  };

  useEffect(() => {
    if (viewMode === 'history' && db && user) {
      loadGameHistory();
    }
  }, [viewMode, db, user, sortOrder]);

  const updateNumber = (num, nameIndex, value) => {
    const updated = { ...numbers };
    updated[num].names[nameIndex] = value;
    setNumbers(updated);
  };

  const fillBlanks = () => {
    const updated = { ...numbers };
    for (let i = 1; i <= 50; i++) {
      if (updated[i].names[0].trim() === '') {
        updated[i].names[0] = 'KRISTEL MAE BEN';
      }
    }
    setNumbers(updated);
  };

  const startGame = async () => {
    fillBlanks();
    const allNumbers = [];
    for (let i = 1; i <= 50; i++) {
      if (numbers[i].names[0].trim() || numbers[i].names[1].trim()) {
        allNumbers.push(i);
      }
    }
    
    if (allNumbers.length < 3) {
      alert('Need at least 3 numbers with participants!');
      return;
    }

    setParticipants(allNumbers);
    const status = {};
    allNumbers.forEach(num => {
      status[num] = 'active';
    });
    setParticipantStatus(status);
    setRemainingCount(allNumbers.length);
    setHistory([]);
    setWinners([]);
    setShowWinners(false);
    setGameStarted(true);
    setFinalWinners(null);
    setGameCompleted(false);

    // Save game to Firebase
    if (db) {
      try {
        const gameRef = await db.collection('users').doc(user.uid).collection('games').add({
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          prizes: prizes,
          numbers: numbers,
          status: 'in_progress',
          totalParticipants: allNumbers.length,
          rounds: []
        });
        setCurrentGameId(gameRef.id);
      } catch (error) {
        console.error('Error saving game:', error);
      }
    }
  };

  const animateReel = (reelRef, duration) => {
    return new Promise((resolve) => {
      if (!reelRef || !reelRef.current) {
        resolve();
        return;
      }
      
      const container = reelRef.current;
      const itemHeight = 100;
      const totalItems = container.children.length;
      const finalPosition = -(totalItems - 1) * itemHeight;

      if (window.gsap) {
        window.gsap.fromTo(container, 
          { y: 0 },
          {
            y: finalPosition,
            duration: duration,
            ease: "power3.out",
            onComplete: resolve
          }
        );
      }
    });
  };

  const fisherYatesShuffle = (array) => {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
  };

  const saveWinnersToDatabase = async (winnersData) => {
    if (!db || !currentGameId) return;
    
    try {
      await db.collection('users')
        .doc(user.uid)
        .collection('games')
        .doc(currentGameId)
        .update({
          status: 'completed',
          completedAt: firebase.firestore.FieldValue.serverTimestamp(),
          winners: winnersData,
          totalRounds: history.length
        });
      setGameCompleted(true);
    } catch (error) {
      console.error('Error saving winners:', error);
    }
  };

  const spinReels = async () => {
    const activeNumbers = participants.filter(num => participantStatus[num] === 'active');
    
    if (activeNumbers.length < 3) {
      alert('Need at least 3 active numbers!');
      return;
    }

    // If exactly 3 players left, declare winners immediately
    if (activeNumbers.length === 3) {
      const shuffled = fisherYatesShuffle(activeNumbers);
      const getWinnerDisplay = (num) => {
        const name1 = numbers[num].names[0];
        const name2 = numbers[num].names[1];
        return name2 ? `#${num} (${name1}/${name2})` : `#${num} (${name1})`;
      };
      
      const winnersData = {
        first: { display: getWinnerDisplay(shuffled[0]), number: shuffled[0], prize: prizes.first },
        second: { display: getWinnerDisplay(shuffled[1]), number: shuffled[1], prize: prizes.second },
        third: { display: getWinnerDisplay(shuffled[2]), number: shuffled[2], prize: prizes.third }
      };
      
      setFinalWinners({
        first: winnersData.first.display || '---',
        second: winnersData.second.display || '---',
        third: winnersData.third.display || '---'
      });
      setShowWinners(true);
      setRemainingCount(0);
      setGameCompleted(true);
      
      // Save winners to database
      await saveWinnersToDatabase(winnersData);
      return;
    }

    setIsSpinning(true);
    setShowWinners(false);

    const shuffled = fisherYatesShuffle(activeNumbers);
    
    // Determine how many to eliminate based on remaining players
    let eliminateCount = 3;
    if (activeNumbers.length === 4) {
      eliminateCount = 1;
    } else if (activeNumbers.length === 5) {
      eliminateCount = 2;
    } else if (activeNumbers.length === 6) {
      eliminateCount = 3;
    }
    
    const losers = shuffled.slice(0, eliminateCount);
    const loser1 = losers[0];
    const loser2 = losers[1] || null;
    const loser3 = losers[2] || null;

    const createReelData = (loserNum) => {
      if (!loserNum) return [];
      const reelData = [];
      for (let i = 0; i < 50; i++) {
        const randomNum = activeNumbers[Math.floor(Math.random() * activeNumbers.length)];
        reelData.push(randomNum);
      }
      reelData.push(loserNum);
      return reelData;
    };

    setReel1Data(createReelData(loser1));
    setReel2Data(loser2 ? createReelData(loser2) : []);
    setReel3Data(loser3 ? createReelData(loser3) : []);

    await new Promise(resolve => setTimeout(resolve, 100));

    await animateReel(reel1Ref, 3);
    if (loser2) await animateReel(reel2Ref, 4);
    if (loser3) await animateReel(reel3Ref, 5);

    setIsSpinning(false);

    const newStatus = { ...participantStatus };
    losers.forEach(loserNum => {
      if (loserNum) newStatus[loserNum] = 'out';
    });
    setParticipantStatus(newStatus);

    const newHistory = [...history, {
      round: history.length + 1,
      eliminated: losers.filter(l => l !== null)
    }];
    setHistory(newHistory);

    const remaining = activeNumbers.length - eliminateCount;
    setRemainingCount(remaining);

    const getNumberDisplay = (num) => {
      if (!num) return null;
      const name1 = numbers[num].names[0];
      const name2 = numbers[num].names[1];
      return name2 ? `#${num} (${name1}/${name2})` : `#${num} (${name1})`;
    };

    const winnersList = losers.filter(l => l !== null).map(loser => ({
      position: 'OUT',
      name: getNumberDisplay(loser)
    }));
    setWinners(winnersList);

    // Save round to database
    if (db && currentGameId) {
      try {
        await db.collection('users')
          .doc(user.uid)
          .collection('games')
          .doc(currentGameId)
          .update({
            rounds: firebase.firestore.FieldValue.arrayUnion({
              round: history.length + 1,
              eliminated: losers.filter(l => l !== null),
              timestamp: new Date()
            })
          });
      } catch (error) {
        console.error('Error saving round:', error);
      }
    }

    if (remaining === 3) {
      setTimeout(async () => {
        const finalThree = activeNumbers.filter(num => !losers.includes(num));
        const shuffledFinal = fisherYatesShuffle(finalThree);
        const getWinnerDisplay = (num) => {
          const name1 = numbers[num].names[0];
          const name2 = numbers[num].names[1];
          return name2 ? `#${num} (${name1}/${name2})` : `#${num} (${name1})`;
        };
        
        const winnersData = {
          first: { display: getWinnerDisplay(shuffledFinal[0]), number: shuffledFinal[0], prize: prizes.first },
          second: { display: getWinnerDisplay(shuffledFinal[1]), number: shuffledFinal[1], prize: prizes.second },
          third: { display: getWinnerDisplay(shuffledFinal[2]), number: shuffledFinal[2], prize: prizes.third }
        };
        
        setFinalWinners({
          first: winnersData.first.display || '---',
          second: winnersData.second.display || '---',
          third: winnersData.third.display || '---'
        });
        setShowWinners(true);
        setGameCompleted(true);
        
        // Save winners to database
        await saveWinnersToDatabase(winnersData);
      }, 300);
    } else if (remaining > 3) {
      setTimeout(() => setShowWinners(true), 300);
    }
  };

  const reset = () => {
    setParticipants([]);
    setParticipantStatus({});
    setHistory([]);
    setWinners([]);
    setShowWinners(false);
    setRemainingCount(0);
    setReel1Data([]);
    setReel2Data([]);
    setReel3Data([]);
    setGameStarted(false);
    setFinalWinners(null);
    setGameCompleted(false);
    setCurrentGameId(null);
    
    const init = {};
    for (let i = 1; i <= 50; i++) {
      init[i] = { names: ['', ''] };
    }
    setNumbers(init);
    
    [reel1Ref, reel2Ref, reel3Ref].forEach(ref => {
      if (ref.current && window.gsap) {
        window.gsap.set(ref.current, { y: 0 });
      }
    });
  };

  const handleLogout = async () => {
    await firebase.auth().signOut();
    window.location.href = 'login.html';
  };

  const formatDate = (date) => {
    if (!date) return 'N/A';
    return new Date(date).toLocaleString('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
  };

  const viewGameDetails = (game) => {
    setSelectedGame(game);
  };

  const closeGameDetails = () => {
    setSelectedGame(null);
  };

  if (viewMode === 'history') {
    return (
      <div className="min-h-screen p-8 bg-gray-950">
        <div className="max-w-7xl mx-auto">
          <div className="flex justify-between items-center mb-8">
            <div>
              <h1 className="text-4xl font-black text-center mb-2 neon-text">
                GAME HISTORY
              </h1>
              <p className="text-center text-gray-400 text-sm">View all past game results</p>
            </div>
            <div className="flex gap-4">
              <button
                onClick={() => setViewMode('game')}
                className="px-6 py-3 bg-blue-900 hover:bg-blue-800 text-white font-bold rounded-lg transition"
              >
                ‚Üê BACK TO GAME
              </button>
              <button
                onClick={handleLogout}
                className="px-6 py-3 bg-red-900 hover:bg-red-800 text-white font-bold rounded-lg transition"
              >
                LOGOUT
              </button>
            </div>
          </div>

          <div className="bg-gray-900 rounded-2xl border border-gray-700 shadow-2xl p-6 mb-6">
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-xl font-bold text-white">Sort by Date</h2>
              <select
                value={sortOrder}
                onChange={(e) => setSortOrder(e.target.value)}
                className="px-4 py-2 bg-gray-800 text-white rounded border border-gray-600 focus:border-green-500 focus:outline-none"
              >
                <option value="desc">Newest First</option>
                <option value="asc">Oldest First</option>
              </select>
            </div>
          </div>

          {loadingHistory ? (
            <div className="text-center py-12">
              <p className="text-white text-xl neon-text">Loading history...</p>
            </div>
          ) : gameHistory.length === 0 ? (
            <div className="bg-gray-900 rounded-2xl border border-gray-700 shadow-2xl p-12 text-center">
              <p className="text-gray-400 text-xl">No games played yet</p>
            </div>
          ) : (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {gameHistory.map((game) => (
                <div key={game.id} className="bg-gray-900 rounded-xl border border-gray-700 shadow-xl p-6 hover:border-green-500 transition">
                  <div className="flex justify-between items-start mb-4">
                    <div>
                      <p className="text-xs text-gray-500 mb-1">Game ID</p>
                      <p className="text-sm text-gray-400 font-mono">{game.id.substring(0, 8)}...</p>
                    </div>
                    <span className={`px-3 py-1 rounded text-xs font-bold ${
                      game.status === 'completed' 
                        ? 'bg-green-900 text-green-300' 
                        : 'bg-yellow-900 text-yellow-300'
                    }`}>
                      {game.status === 'completed' ? '‚úì COMPLETED' : '‚è≥ IN PROGRESS'}
                    </span>
                  </div>

                  <div className="mb-4 pb-4 border-b border-gray-700">
                    <p className="text-xs text-gray-500 mb-1">Date</p>
                    <p className="text-white text-sm">{formatDate(game.createdAt)}</p>
                  </div>

                  <div className="mb-4">
                    <p className="text-xs text-gray-500 mb-2">Participants</p>
                    <p className="text-2xl font-black text-green-400">{game.totalParticipants}</p>
                  </div>

                  {game.status === 'completed' && game.winners && (
                    <div className="mb-4 space-y-2">
                      <div className="bg-yellow-900 bg-opacity-30 rounded p-2">
                        <p className="text-xs text-yellow-400">ü•á 1st Place</p>
                        <p className="text-white font-bold text-sm truncate">{game.winners.first?.display}</p>
                      </div>
                      <div className="bg-gray-700 bg-opacity-30 rounded p-2">
                        <p className="text-xs text-gray-400">ü•à 2nd Place</p>
                        <p className="text-white font-bold text-sm truncate">{game.winners.second?.display}</p>
                      </div>
                      <div className="bg-orange-900 bg-opacity-30 rounded p-2">
                        <p className="text-xs text-orange-400">ü•â 3rd Place</p>
                        <p className="text-white font-bold text-sm truncate">{game.winners.third?.display}</p>
                      </div>
                    </div>
                  )}

                  <button
                    onClick={() => viewGameDetails(game)}
                    className="w-full py-2 bg-blue-900 hover:bg-blue-800 text-white font-bold rounded transition text-sm"
                  >
                    VIEW DETAILS
                  </button>
                </div>
              ))}
            </div>
          )}

          {/* Game Details Modal */}
          {selectedGame && (
            <div className="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 z-50" onClick={closeGameDetails}>
              <div className="bg-gray-900 rounded-2xl border border-gray-700 shadow-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                <div className="flex justify-between items-start mb-6">
                  <div>
                    <h2 className="text-3xl font-black text-white mb-2 neon-text">GAME DETAILS</h2>
                    <p className="text-gray-400">Game ID: {selectedGame.id}</p>
                  </div>
                  <button
                    onClick={closeGameDetails}
                    className="text-gray-400 hover:text-white text-3xl font-bold"
                  >
                    √ó
                  </button>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                  <div className="bg-gray-800 rounded-lg p-4">
                    <p className="text-xs text-gray-500 mb-1">Started</p>
                    <p className="text-white font-bold">{formatDate(selectedGame.createdAt)}</p>
                  </div>
                  {selectedGame.completedAt && (
                    <div className="bg-gray-800 rounded-lg p-4">
                      <p className="text-xs text-gray-500 mb-1">Completed</p>
                      <p className="text-white font-bold">{formatDate(selectedGame.completedAt?.toDate())}</p>
                    </div>
                  )}
                  <div className="bg-gray-800 rounded-lg p-4">
                    <p className="text-xs text-gray-500 mb-1">Total Participants</p>
                    <p className="text-green-400 font-black text-2xl">{selectedGame.totalParticipants}</p>
                  </div>
                  <div className="bg-gray-800 rounded-lg p-4">
                    <p className="text-xs text-gray-500 mb-1">Total Rounds</p>
                    <p className="text-blue-400 font-black text-2xl">{selectedGame.rounds?.length || 0}</p>
                  </div>
                </div>

                {selectedGame.status === 'completed' && selectedGame.winners && (
                  <div className="mb-6">
                    <h3 className="text-2xl font-black text-white mb-4 neon-text">üèÜ WINNERS</h3>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div className="bg-gradient-to-b from-yellow-500 to-yellow-700 rounded-xl p-6 border-4 border-yellow-300">
                        <p className="text-center text-6xl mb-2">ü•á</p>
                        <p className="text-white font-black text-xl text-center mb-2">CHAMPION</p>
                        <p className="text-white font-bold text-center mb-3">{selectedGame.winners.first?.display}</p>
                        <div className="bg-black bg-opacity-40 rounded p-2">
                          <p className="text-yellow-200 text-xs text-center mb-1">Prize</p>
                          <p className="text-yellow-100 font-bold text-center">{selectedGame.prizes?.first || 'N/A'}</p>
                        </div>
                      </div>

                      <div className="bg-gradient-to-b from-gray-300 to-gray-600 rounded-xl p-6 border-4 border-gray-200">
                        <p className="text-center text-6xl mb-2">ü•à</p>
                        <p className="text-gray-900 font-black text-xl text-center mb-2">RUNNER-UP</p>
                        <p className="text-gray-900 font-bold text-center mb-3">{selectedGame.winners.second?.display}</p>
                        <div className="bg-black bg-opacity-20 rounded p-2">
                          <p className="text-gray-700 text-xs text-center mb-1">Prize</p>
                          <p className="text-gray-900 font-bold text-center">{selectedGame.prizes?.second || 'N/A'}</p>
                        </div>
                      </div>

                      <div className="bg-gradient-to-b from-orange-600 to-red-700 rounded-xl p-6 border-4 border-orange-400">
                        <p className="text-center text-6xl mb-2">ü•â</p>
                        <p className="text-white font-black text-xl text-center mb-2">THIRD PLACE</p>
                        <p className="text-white font-bold text-center mb-3">{selectedGame.winners.third?.display}</p>
                        <div className="bg-black bg-opacity-40 rounded p-2">
                          <p className="text-orange-200 text-xs text-center mb-1">Prize</p>
                          <p className="text-orange-100 font-bold text-center">{selectedGame.prizes?.third || 'N/A'}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {selectedGame.rounds && selectedGame.rounds.length > 0 && (
                  <div className="mb-6">
                    <h3 className="text-xl font-black text-white mb-4">ELIMINATION ROUNDS</h3>
                    <div className="space-y-3 max-h-64 overflow-y-auto">
                      {selectedGame.rounds.map((round, idx) => (
                        <div key={idx} className="bg-gray-800 rounded-lg p-4 border border-gray-700">
                          <p className="text-green-400 font-bold mb-2">Round {round.round}</p>
                          <p className="text-gray-300 text-sm">
                            Eliminated: <span className="text-red-400 font-bold">
                              {round.eliminated.map(num => `#${num}`).join(', ')}
                            </span>
                          </p>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {selectedGame.numbers && (
                  <div>
                    <h3 className="text-xl font-black text-white mb-4">PARTICIPANTS</h3>
                    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 max-h-64 overflow-y-auto">
                      {Object.keys(selectedGame.numbers).map((num) => {
                        const participant = selectedGame.numbers[num];
                        if (!participant.names[0].trim() && !participant.names[1].trim()) return null;
                        
                        return (
                          <div key={num} className="bg-gray-800 rounded-lg p-3 border border-gray-700">
                            <div className="text-center font-bold text-green-400 mb-2">#{num}</div>
                            <p className="text-white text-xs text-center truncate">{participant.names[0]}</p>
                            {participant.names[1] && (
                              <p className="text-gray-400 text-xs text-center truncate">{participant.names[1]}</p>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>
                )}
              </div>
            </div>
          )}
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen p-8 bg-gray-950">
      <div className="max-w-7xl mx-auto">
        <div className="flex justify-between items-center mb-8">
          <div>
            <h1 className="text-5xl font-black text-center mb-2 neon-text">
              PROFESSIONAL SLOT RAFFLE
            </h1>
            <p className="text-center text-gray-400 mb-4 text-lg">LAST MAN STANDING - ELIMINATION SERIES</p>
            <p className="text-center text-green-400 text-sm">User: {user?.email}</p>
          </div>
          <div className="flex gap-4">
            <button
              onClick={() => setViewMode('history')}
              className="px-6 py-3 bg-purple-900 hover:bg-purple-800 text-white font-bold rounded-lg transition"
            >
              üìä VIEW HISTORY
            </button>
            <button
              onClick={handleLogout}
              className="px-6 py-3 bg-red-900 hover:bg-red-800 text-white font-bold rounded-lg transition"
            >
              LOGOUT
            </button>
          </div>
        </div>

        <div className="grid grid-cols-1 xl:grid-cols-3 gap-8">
          {/* LEFT PANEL - SETUP */}
          <div className="xl:col-span-2">
            {!gameStarted ? (
              <>
                <div className="bg-gray-900 rounded-2xl border border-gray-700 shadow-2xl p-8 mb-8">
                  <h2 className="text-2xl font-bold text-white mb-6 pb-4 border-b border-gray-700">
                    SETUP: ASSIGN NAMES TO NUMBERS (1-50)
                  </h2>

                  <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4 mb-6 max-h-96 overflow-y-auto">
                    {Object.keys(numbers).map((num) => (
                      <div key={num} className="bg-gray-800 rounded-lg p-3 border border-gray-700">
                        <div className="text-center font-bold text-green-400 mb-2 text-lg">#{num}</div>
                        <input
                          type="text"
                          placeholder="Name 1"
                          value={numbers[num].names[0]}
                          onChange={(e) => updateNumber(parseInt(num), 0, e.target.value)}
                          className="w-full text-xs px-2 py-1 bg-gray-700 text-white rounded mb-1 border border-gray-600 focus:border-green-500 focus:outline-none"
                        />
                        <input
                          type="text"
                          placeholder="Name 2 (Optional)"
                          value={numbers[num].names[1]}
                          onChange={(e) => updateNumber(parseInt(num), 1, e.target.value)}
                          className="w-full text-xs px-2 py-1 bg-gray-700 text-white rounded border border-gray-600 focus:border-green-500 focus:outline-none opacity-75"
                        />
                      </div>
                    ))}
                  </div>
                </div>

                <div className="bg-gray-900 rounded-2xl border border-gray-700 shadow-2xl p-8">
                  <h2 className="text-2xl font-bold text-white mb-6 pb-4 border-b border-gray-700">
                    PRIZE POOL SETUP
                  </h2>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-yellow-400 font-bold mb-2 text-sm">ü•á FIRST PLACE PRIZE</label>
                      <input
                        type="text"
                        placeholder="e.g., $10,000 or 50,000 PHP"
                        value={prizes.first}
                        onChange={(e) => setPrizes({ ...prizes, first: e.target.value })}
                        className="w-full px-4 py-3 bg-gray-800 text-white rounded border border-yellow-600 focus:border-yellow-400 focus:outline-none font-bold text-lg"
                      />
                    </div>

                    <div>
                      <label className="block text-gray-300 font-bold mb-2 text-sm">ü•à SECOND PLACE PRIZE</label>
                      <input
                        type="text"
                        placeholder="e.g., $5,000 or 25,000 PHP"
                        value={prizes.second}
                        onChange={(e) => setPrizes({ ...prizes, second: e.target.value })}
                        className="w-full px-4 py-3 bg-gray-800 text-white rounded border border-gray-500 focus:border-gray-400 focus:outline-none font-bold text-lg"
                      />
                    </div>

                    <div>
                      <label className="block text-orange-600 font-bold mb-2 text-sm">ü•â THIRD PLACE PRIZE</label>
                      <input
                        type="text"
                        placeholder="e.g., $2,500 or 12,500 PHP"
                        value={prizes.third}
                        onChange={(e) => setPrizes({ ...prizes, third: e.target.value })}
                        className="w-full px-4 py-3 bg-gray-800 text-white rounded border border-orange-700 focus:border-orange-500 focus:outline-none font-bold text-lg"
                      />
                    </div>
                  </div>

                  <button
                    onClick={startGame}
                    className="w-full py-4 rounded-lg font-bold text-lg text-white transition bg-green-600 hover:bg-green-700"
                  >
                    ‚ñ∫ START GAME
                  </button>
                </div>
              </>
            ) : (
              <div className="bg-gray-900 rounded-2xl border border-gray-700 shadow-2xl p-8">
                <h2 className="text-2xl font-bold text-white mb-6 pb-4 border-b border-gray-700">
                  GAME IN PROGRESS
                </h2>
                <button
                  onClick={reset}
                  disabled={isSpinning}
                  className="w-full py-4 rounded-lg font-bold text-lg text-white transition bg-red-900 hover:bg-red-800 disabled:bg-gray-600 disabled:cursor-not-allowed"
                >
                  RESET ALL & START OVER
                </button>
              </div>
            )}
          </div>

          {/* RIGHT PANEL - STATUS */}
          <div className="bg-gray-900 rounded-2xl border border-gray-700 shadow-2xl p-6">
            <h2 className="text-xl font-bold text-white mb-4 pb-3 border-b border-gray-700">
              GAME STATUS
            </h2>
            
            {gameStarted ? (
              <>
                <div className="mb-6 p-4 bg-gray-800 rounded-lg border border-green-600 border-opacity-50">
                  <p className="text-gray-400 text-sm mb-1">REMAINING</p>
                  <p className="text-green-400 font-black text-3xl">{remainingCount}</p>
                </div>

                <div className="mb-6">
                  <p className="text-gray-400 text-sm mb-2 font-bold">ROUNDS COMPLETED</p>
                  <p className="text-white text-2xl font-black">{history.length}</p>
                </div>

                {remainingCount > 3 && remainingCount <= 6 && (
                  <div className="bg-yellow-900 border border-yellow-600 rounded-lg p-3 mb-4">
                    <p className="text-yellow-300 font-bold text-sm">‚ö† FINAL ROUND APPROACHING</p>
                  </div>
                )}

                {gameCompleted ? (
                  <div className="bg-green-900 border border-green-600 rounded-lg p-4 mb-4">
                    <p className="text-green-300 font-bold text-center">‚úì GAME COMPLETED!</p>
                    <p className="text-green-400 text-xs text-center mt-2">Winners have been saved</p>
                  </div>
                ) : (
                  <button
                    onClick={spinReels}
                    disabled={isSpinning || remainingCount <= 3}
                    className={`w-full py-4 rounded-lg font-black text-white transition ${
                      isSpinning || remainingCount <= 3
                        ? 'bg-gray-600 cursor-not-allowed' 
                        : 'bg-blue-600 hover:bg-blue-700'
                    }`}
                  >
                    {isSpinning ? '‚è≥ SPINNING...' : '‚ñ∫ SPIN ELIMINATOR'}
                  </button>
                )}
              </>
            ) : (
              <p className="text-gray-500 text-center py-8">CONFIGURE GAME TO START</p>
            )}
          </div>
        </div>

        {/* SPIN DISPLAY */}
        {gameStarted && (
          <div className="mt-8 bg-gray-900 rounded-2xl border border-gray-700 shadow-2xl p-8">
            <h2 className="text-2xl font-bold text-center text-white mb-6 neon-text">ELIMINATION REELS</h2>
            <div className="grid grid-cols-3 gap-4 mb-6">
              <div className="slot-reel rounded-xl h-40">
                <div ref={reel1Ref} className="slot-container">
                  {reel1Data.length > 0 ? reel1Data.map((name, idx) => (
                    <div key={idx} className="slot-item">#{name}</div>
                  )) : (
                    <div className="slot-item">---</div>
                  )}
                </div>
              </div>

              <div className="slot-reel rounded-xl h-40">
                <div ref={reel2Ref} className="slot-container">
                  {reel2Data.length > 0 ? reel2Data.map((name, idx) => (
                    <div key={idx} className="slot-item">#{name}</div>
                  )) : (
                    <div className="slot-item">---</div>
                  )}
                </div>
              </div>

              <div className="slot-reel rounded-xl h-40">
                <div ref={reel3Ref} className="slot-container">
                  {reel3Data.length > 0 ? reel3Data.map((name, idx) => (
                    <div key={idx} className="slot-item">#{name}</div>
                  )) : (
                    <div className="slot-item">---</div>
                  )}
                </div>
              </div>
            </div>

            {showWinners && winners.length > 0 && !finalWinners && (
              <div className="border-t border-gray-700 pt-6">
                <h3 className="text-xl font-bold text-center text-red-400 mb-4">‚ö° ELIMINATED THIS ROUND ‚ö°</h3>
                <div className="grid grid-cols-3 gap-4">
                  {winners.map((w, idx) => (
                    <div key={idx} className="winner-card rounded-lg p-4 bg-red-950 border-2 border-red-600">
                      <p className="text-red-400 font-bold text-sm mb-2">{w.position}</p>
                      <p className="text-white font-black text-lg text-center">{w.name}</p>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {finalWinners && (
              <div className="border-t border-gray-700 pt-6">
                <h3 className="text-3xl font-black text-center mb-8 neon-text">üèÜ FINAL WINNERS üèÜ</h3>
                
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                  <div className="prize-gold bg-gradient-to-b from-yellow-500 to-yellow-700 rounded-xl p-6 border-4 border-yellow-300">
                    <div className="text-center">
                      <p className="text-6xl mb-3">ü•á</p>
                      <p className="text-white font-black text-3xl mb-2">CHAMPION</p>
                      <p className="text-white font-black text-2xl mb-4">{finalWinners.first}</p>
                      <div className="bg-black bg-opacity-40 rounded-lg p-3">
                        <p className="text-yellow-200 text-xs font-bold mb-1">PRIZE POOL</p>
                        <p className="text-yellow-100 font-black text-2xl">{prizes.first || '---'}</p>
                      </div>
                    </div>
                  </div>

                  <div className="prize-silver bg-gradient-to-b from-gray-300 to-gray-600 rounded-xl p-6 border-4 border-gray-200">
                    <div className="text-center">
                      <p className="text-6xl mb-3">ü•à</p>
                      <p className="text-gray-900 font-black text-3xl mb-2">RUNNER-UP</p>
                      <p className="text-gray-900 font-black text-2xl mb-4">{finalWinners.second}</p>
                      <div className="bg-black bg-opacity-20 rounded-lg p-3">
                        <p className="text-gray-700 text-xs font-bold mb-1">PRIZE POOL</p>
                        <p className="text-gray-900 font-black text-2xl">{prizes.second || '---'}</p>
                      </div>
                    </div>
                  </div>

                  <div className="prize-bronze bg-gradient-to-b from-orange-600 to-red-700 rounded-xl p-6 border-4 border-orange-400">
                    <div className="text-center">
                      <p className="text-6xl mb-3">ü•â</p>
                      <p className="text-white font-black text-3xl mb-2">THIRD PLACE</p>
                      <p className="text-white font-black text-2xl mb-4">{finalWinners.third}</p>
                      <div className="bg-black bg-opacity-40 rounded-lg p-3">
                        <p className="text-orange-200 text-xs font-bold mb-1">PRIZE POOL</p>
                        <p className="text-orange-100 font-black text-2xl">{prizes.third || '---'}</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </div>
        )}

        {/* PARTICIPANT LIST */}
        {gameStarted && (
          <div className="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div className="bg-gray-900 rounded-2xl border border-gray-700 shadow-2xl p-6">
              <h3 className="text-xl font-bold text-white mb-4 pb-3 border-b border-gray-700">
                STILL IN THE GAME ({participants.filter(p => participantStatus[p] === 'active').length})
              </h3>
              <div className="space-y-2 max-h-96 overflow-y-auto">
                {participants.filter(p => participantStatus[p] === 'active').map((name, idx) => (
                  <div key={idx} className="status-active p-3 rounded text-green-400 font-semibold text-sm">
                    ‚úì #{name}
                  </div>
                ))}
              </div>
            </div>

            <div className="bg-gray-900 rounded-2xl border border-gray-700 shadow-2xl p-6">
              <h3 className="text-xl font-bold text-white mb-4 pb-3 border-b border-gray-700">
                ELIMINATED ({participants.filter(p => participantStatus[p] === 'out').length})
              </h3>
              <div className="space-y-2 max-h-96 overflow-y-auto">
                {participants.filter(p => participantStatus[p] === 'out').map((name, idx) => (
                  <div key={idx} className="status-out p-3 rounded text-red-400 font-semibold text-sm">
                    ‚úó #{name}
                  </div>
                ))}
              </div>
            </div>
          </div>
        )}

        {/* HISTORY */}
        {history.length > 0 && (
          <div className="mt-8 bg-gray-900 rounded-2xl border border-gray-700 shadow-2xl p-6">
            <h3 className="text-xl font-bold text-white mb-4 pb-3 border-b border-gray-700">
              ELIMINATION HISTORY
            </h3>
            <div className="space-y-3 max-h-48 overflow-y-auto">
              {history.map((round, idx) => (
                <div key={idx} className="bg-gray-800 p-4 rounded border border-gray-700">
                  <p className="text-green-400 font-bold mb-2">ROUND {round.round}</p>
                  <p className="text-gray-300 text-sm">
                    Eliminated: <span className="text-red-400 font-bold">#{round.eliminated.join(' | #')}</span>
                  </p>
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>